{"ast":null,"code":"import _regeneratorRuntime from\"D:\\\\Programa\\xE7\\xE3oB7Web\\\\Projetos\\\\olx-clone\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"D:\\\\Programa\\xE7\\xE3oB7Web\\\\Projetos\\\\olx-clone\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"D:\\\\Programa\\xE7\\xE3oB7Web\\\\Projetos\\\\olx-clone\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{Item}from'./styled';import{Link}from'react-router-dom';import useApi from'../../../helpers/MBSApi';import Modal from\"react-bootstrap/Modal\";import React,{useState,useRef,useEffect}from'react';import MaskedInput from'react-text-mask';import createNumberMask from'text-mask-addons/dist/createNumberMask';export default(function(props){var api=useApi();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isOpen=_useState2[0],setIsOpen=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),disabled=_useState4[0],setDisabled=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),categories=_useState8[0],setCategories=_useState8[1];//dados para edição de anuncios\nvar fileField=useRef();var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),newTitle=_useState10[0],setTitle=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),newCategory=_useState12[0],setCategory=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),newPrice=_useState14[0],setPrice=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),priceNegotiable=_useState16[0],setPriceNegotiable=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),newDesc=_useState18[0],setDesc=_useState18[1];var _useState19=useState(''),_useState20=_slicedToArray(_useState19,2),itemId=_useState20[0],setItemId=_useState20[1];var priceMask=createNumberMask({prefix:'R$ ',includeThousandsSeparator:true,thousandsSeparatorSymbol:'.',allowDecimal:true,decimalSymbol:','});var handleClick=function handleClick(){window.location.href=\"/ad/\".concat(props.data.id);};useEffect(function(){var getCategories=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var cats;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return api.getCategories();case 2:cats=_context.sent;setCategories(cats);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getCategories(){return _ref.apply(this,arguments);};}();getCategories();},[]);var handleNewAd=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var errors,fData,i,json;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();setDisabled(true);setError('');errors=[];if(!newTitle.trim()){errors.push(\"Sem título\");}if(!newCategory){errors.push(\"Sem Categoria\");}fData=new FormData();fData.append('title',newTitle);fData.append('price',newPrice);fData.append('priceneg',priceNegotiable);fData.append('desc',newDesc);fData.append('cat',newCategory);if(fileField.current.files.length>0){for(i=0;i<fileField.current.files.length;i++){fData.append('img',fileField.current.files[i]);}}_context2.next=15;return api.updateAdd(fData,itemId);case 15:json=_context2.sent;if(json.error){_context2.next=21;break;}window.location.href=\"/ad/\".concat(itemId);return _context2.abrupt(\"return\");case 21:setError(json.error);case 22:setIsOpen(false);setDisabled(false);case 24:case\"end\":return _context2.stop();}}},_callee2);}));return function handleNewAd(_x){return _ref2.apply(this,arguments);};}();var price='';if(props.data.priceNegotiable){price=\"Preço negociável\";}else{price=\"R$ \".concat(props.data.price,\" \");}var showModal=function showModal(props){setIsOpen(true);setItemId(props);};var hideModal=function hideModal(){setDisabled(false);setIsOpen(false);};return/*#__PURE__*/React.createElement(Item,{className:\"aditem\"},/*#__PURE__*/React.createElement(Link,{to:\"/ ad / \".concat(props.data.id,\" \"),onClick:handleClick},/*#__PURE__*/React.createElement(\"div\",{className:\"p-2 m-2\"},/*#__PURE__*/React.createElement(\"div\",{className:\"item-image\"},props.data.images&&props.data.images.slice(0,2).filter(function(value){return Object.keys(value).length!==0;}).map(function(image,index){return/*#__PURE__*/React.createElement(\"img\",{key:index,src:\"http://alunos.b7web.com.br:501/media/\".concat(image.url),alt:\"\"});}),/*#__PURE__*/React.createElement(\"img\",{src:props.data.image,alt:\"\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"item-name\"},props.data.title),/*#__PURE__*/React.createElement(\"div\",{className:\"item-price\"},price))),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){return showModal(props.data.id);},type:\"button\",className:\"btn btn-primary\"},\"Editar\"),/*#__PURE__*/React.createElement(Modal,{show:isOpen,onHide:hideModal},/*#__PURE__*/React.createElement(Modal.Header,null,\"Edite seu an\\xFAncio\"),/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleNewAd},/*#__PURE__*/React.createElement(Modal.Body,null,/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"inputTitle\",className:\"form-label\"},\"T\\xEDtulo do an\\xFAncio:\",/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control\",id:\"inputTitle\",\"aria-describedby\":\"Help\",disabled:disabled,value:newTitle,onChange:function onChange(e){return setTitle(e.target.value);}}),/*#__PURE__*/React.createElement(\"div\",{id:\"Help\",className:\"form-text\"},\"T\\xEDtulo atual: \",props.data.title))),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"inputCategory\",className:\"form-label\"},\"Categoria:\",/*#__PURE__*/React.createElement(\"select\",{className:\"form-control\",disabled:disabled,onChange:function onChange(e){return setCategory(e.target.value);}},categories&&categories.map(function(i){return/*#__PURE__*/React.createElement(\"option\",{key:i._id,value:i._id},i.name);})),/*#__PURE__*/React.createElement(\"div\",{id:\"Help\",className:\"form-text\"},\"Categoria atual: \",props.data.category))),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"inputPrice\",className:\"form-label\"},\"Pre\\xE7o:\",/*#__PURE__*/React.createElement(MaskedInput,{className:\"form-control\",id:\"inputPrice\",mask:priceMask,placeholder:\"R$ \",disabled:disabled||priceNegotiable,value:newPrice,onChange:function onChange(e){return setPrice(e.target.value);}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"inputNegotiable\",className:\"form-label\"},\"Negoci\\xE1vel?\",/*#__PURE__*/React.createElement(\"input\",{type:\"checkbox\",className:\"form-check-input\",id:\"inputNegotiable\",\"aria-describedby\":\"Help\",disabled:disabled,checked:priceNegotiable,onChange:function onChange(e){return setPriceNegotiable(!priceNegotiable);}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"inputDesc\",className:\"form-label\"},\"Descri\\xE7\\xE3o:\",/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control\",id:\"inputDesc\",disabled:disabled,value:newDesc,onChange:function onChange(e){return setDesc(e.target.value);}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"mb-3 \"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"inputFiles\",className:\"form-label\"},\"Imagens:\",/*#__PURE__*/React.createElement(\"input\",{disabled:disabled,type:\"file\",className:\"form-control\",id:\"inputTitle\",\"aria-describedby\":\"titleHelp\",multiple:true,ref:fileField}),/*#__PURE__*/React.createElement(\"div\",{id:\"Help\",className:\"form-text\"},\"Quantidade de imagens que o an\\xFAncio j\\xE1 possui: \",props.data.images.length)))),/*#__PURE__*/React.createElement(Modal.Footer,null,/*#__PURE__*/React.createElement(\"button\",{type:\"button\",className:\"btn btn-danger\",onClick:hideModal},\"Cancelar\"),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",className:\"btn btn-success\"},\"Salvar\")))));});","map":{"version":3,"sources":["D:/ProgramaçãoB7Web/Projetos/olx-clone/frontend/src/components/partials/EditItem/index.js"],"names":["Item","Link","useApi","Modal","React","useState","useRef","useEffect","MaskedInput","createNumberMask","props","api","isOpen","setIsOpen","disabled","setDisabled","error","setError","categories","setCategories","fileField","newTitle","setTitle","newCategory","setCategory","newPrice","setPrice","priceNegotiable","setPriceNegotiable","newDesc","setDesc","itemId","setItemId","priceMask","prefix","includeThousandsSeparator","thousandsSeparatorSymbol","allowDecimal","decimalSymbol","handleClick","window","location","href","data","id","getCategories","cats","handleNewAd","e","preventDefault","errors","trim","push","fData","FormData","append","current","files","length","i","updateAdd","json","price","showModal","hideModal","images","slice","filter","value","Object","keys","map","image","index","url","title","target","_id","name","category"],"mappings":"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","sourcesContent":["import { Item } from './styled';\r\nimport { Link } from 'react-router-dom';\r\nimport useApi from '../../../helpers/MBSApi';\r\nimport Modal from \"react-bootstrap/Modal\";\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport MaskedInput from 'react-text-mask';\r\nimport createNumberMask from 'text-mask-addons/dist/createNumberMask';\r\n\r\n\r\nexport default (props) => {\r\n    const api = useApi();\r\n    const [isOpen, setIsOpen] = useState(false);\r\n    const [disabled, setDisabled] = useState(false);\r\n    const [error, setError] = useState('');\r\n    const [categories, setCategories] = useState([]);\r\n\r\n    //dados para edição de anuncios\r\n    const fileField = useRef();\r\n    const [newTitle, setTitle] = useState('');\r\n    const [newCategory, setCategory] = useState('');\r\n    const [newPrice, setPrice] = useState('');\r\n    const [priceNegotiable, setPriceNegotiable] = useState(false);\r\n    const [newDesc, setDesc] = useState('');\r\n    const [itemId, setItemId] = useState('');\r\n\r\n    const priceMask = createNumberMask({\r\n        prefix: 'R$ ',\r\n        includeThousandsSeparator: true,\r\n        thousandsSeparatorSymbol: '.',\r\n        allowDecimal: true,\r\n        decimalSymbol: ','\r\n    });\r\n\r\n    const handleClick = () => {\r\n        window.location.href = `/ad/${props.data.id}`;\r\n    }\r\n\r\n    useEffect(() => {\r\n        const getCategories = async () => {\r\n            const cats = await api.getCategories();\r\n            setCategories(cats);\r\n        }\r\n        getCategories();\r\n    }, [])\r\n\r\n    const handleNewAd = async (e) => {\r\n\r\n        e.preventDefault();\r\n        setDisabled(true);\r\n        setError('');\r\n\r\n        let errors = [];\r\n\r\n        if (!newTitle.trim()) {\r\n            errors.push(\"Sem título\");\r\n        }\r\n\r\n        if (!newCategory) {\r\n            errors.push(\"Sem Categoria\");\r\n        }\r\n\r\n        const fData = new FormData();\r\n\r\n        fData.append('title', newTitle);\r\n        fData.append('price', newPrice);\r\n        fData.append('priceneg', priceNegotiable);\r\n        fData.append('desc', newDesc);\r\n        fData.append('cat', newCategory);\r\n\r\n        if (fileField.current.files.length > 0) {\r\n            for (let i = 0; i < fileField.current.files.length; i++) {\r\n                fData.append('img', fileField.current.files[i]);\r\n            }\r\n        }\r\n\r\n        const json = await api.updateAdd(fData, itemId);\r\n\r\n\r\n        if (!json.error) {\r\n            window.location.href = `/ad/${itemId}`;\r\n            return;\r\n\r\n        } else {\r\n            setError(json.error);\r\n        }\r\n\r\n        setIsOpen(false);\r\n        setDisabled(false);\r\n\r\n    }\r\n\r\n    let price = '';\r\n\r\n    if (props.data.priceNegotiable) {\r\n        price = \"Preço negociável\";\r\n    } else {\r\n        price = `R$ ${props.data.price} `\r\n    }\r\n\r\n    const showModal = (props) => {\r\n        setIsOpen(true)\r\n        setItemId(props)\r\n    }\r\n\r\n    const hideModal = () => {\r\n        setDisabled(false);\r\n        setIsOpen(false)\r\n    }\r\n\r\n    return (\r\n        <Item className=\"aditem\">\r\n            <Link to={`/ ad / ${props.data.id} `} onClick={handleClick}>\r\n                <div className=\"p-2 m-2\">\r\n                    <div className=\"item-image\">\r\n\r\n                        {\r\n                            props.data.images &&\r\n\r\n                            props.data.images\r\n                                .slice(0, 2)\r\n                                .filter(value => Object.keys(value).length !== 0)\r\n                                .map((image, index) =>\r\n                                    <img key={index} src={`http://alunos.b7web.com.br:501/media/${image.url}`} alt=\"\" />\r\n                                )\r\n                        }\r\n\r\n                        <img src={props.data.image} alt=\"\" />\r\n\r\n                    </div >\r\n                    <div className=\"item-name\">\r\n                        {props.data.title}\r\n                    </div>\r\n                    <div className=\"item-price\">\r\n                        {price}\r\n                    </div>\r\n                </div >\r\n\r\n            </Link >\r\n            <button onClick={() => showModal(props.data.id)} type=\"button\" className=\"btn btn-primary\">Editar</button>\r\n            <Modal show={isOpen} onHide={hideModal}>\r\n                <Modal.Header>\r\n                    Edite seu anúncio\r\n                </Modal.Header>\r\n                <form onSubmit={handleNewAd}>\r\n                    <Modal.Body>\r\n                        <div className=\"mb-3\">\r\n                            <label htmlFor=\"inputTitle\" className=\"form-label\">\r\n                                Título do anúncio:\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-control\"\r\n                                    id=\"inputTitle\"\r\n                                    aria-describedby=\"Help\"\r\n                                    disabled={disabled}\r\n                                    value={newTitle}\r\n                                    onChange={e => setTitle(e.target.value)} />\r\n                                <div id=\"Help\" className=\"form-text\">Título atual: {props.data.title}</div>\r\n                            </label>\r\n                        </div>\r\n                        <div className=\"mb-3\">\r\n                            <label htmlFor=\"inputCategory\" className=\"form-label\">\r\n                                Categoria:\r\n                                <select\r\n                                    className=\"form-control\"\r\n                                    disabled={disabled}\r\n                                    onChange={e => setCategory(e.target.value)}\r\n                                >\r\n                                    {categories && categories.map(i =>\r\n                                        <option key={i._id} value={i._id}>{i.name}</option>\r\n                                    )}\r\n                                </select>\r\n                                <div id=\"Help\" className=\"form-text\">Categoria atual: {props.data.category}</div>\r\n                            </label>\r\n                        </div>\r\n                        <div className=\"mb-3\">\r\n                            <label htmlFor=\"inputPrice\" className=\"form-label\">\r\n                                Preço:\r\n                                <MaskedInput\r\n                                    className=\"form-control\"\r\n                                    id=\"inputPrice\"\r\n                                    mask={priceMask}\r\n                                    placeholder=\"R$ \"\r\n                                    disabled={disabled || priceNegotiable}\r\n                                    value={newPrice}\r\n                                    onChange={e => setPrice(e.target.value)}\r\n                                />\r\n                            </label>\r\n                        </div>\r\n                        <div className=\"mb-3\">\r\n                            <label htmlFor=\"inputNegotiable\" className=\"form-label\">\r\n                                Negociável?\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    className=\"form-check-input\"\r\n                                    id=\"inputNegotiable\"\r\n                                    aria-describedby=\"Help\"\r\n                                    disabled={disabled}\r\n                                    checked={priceNegotiable}\r\n                                    onChange={e => setPriceNegotiable(!priceNegotiable)}\r\n                                />\r\n                            </label>\r\n                        </div>\r\n                        <div className=\"mb-3\">\r\n                            <label htmlFor=\"inputDesc\" className=\"form-label\">\r\n                                Descrição:\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"form-control\"\r\n                                    id=\"inputDesc\"\r\n                                    disabled={disabled}\r\n                                    value={newDesc}\r\n                                    onChange={e => setDesc(e.target.value)}\r\n                                />\r\n                            </label>\r\n                        </div>\r\n                        <div className=\"mb-3 \">\r\n                            <label htmlFor=\"inputFiles\" className=\"form-label\">\r\n                                Imagens:\r\n                                <input\r\n                                    disabled={disabled}\r\n                                    type=\"file\"\r\n                                    className=\"form-control\"\r\n                                    id=\"inputTitle\"\r\n                                    aria-describedby=\"titleHelp\"\r\n                                    multiple\r\n                                    ref={fileField} />\r\n                                <div id=\"Help\" className=\"form-text\">Quantidade de imagens que o anúncio já possui: {props.data.images.length}</div>\r\n                            </label>\r\n                        </div>\r\n                    </Modal.Body>\r\n                    <Modal.Footer>\r\n                        <button type=\"button\" className=\"btn btn-danger\" onClick={hideModal}>Cancelar</button>\r\n                        <button type=\"submit\" className=\"btn btn-success\">Salvar</button>\r\n                    </Modal.Footer>\r\n                </form>\r\n            </Modal>\r\n        </Item >\r\n    );\r\n}"]},"metadata":{},"sourceType":"module"}